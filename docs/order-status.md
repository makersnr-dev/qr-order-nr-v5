# 주문 상태(Status) 및 결제(Payment) 처리 규칙

본 문서는 QR Order 시스템의
- 주문 상태(status)
- 결제 상태(meta.payment)
- 취소 처리(meta.cancel)

에 대한 **단일 기준 문서**이다.

---

## 1. 기본 원칙 (중요)

### 1-1. status 와 payment 는 분리한다

- `status` : 주문의 진행 상태
- `meta.payment` : 결제 여부 / 방식 / 시점
- 결제 완료는 **status를 자동 변경하지 않는다**

---

### 1-2. 취소는 반드시 사유를 가진다

- 주문취소 / 결제취소는 모두 `meta.cancel`에 기록
- UI에서는 사유 입력 모달을 반드시 거친다

---

## 2. 매장 주문 (type = store)

### 2-1. 상태 흐름

| 현재 상태 | 이동 가능 상태 |
|----------|----------------|
| 주문접수 | 준비중, 주문취소 |
| 준비중 | 주문완료, 주문취소, 결제취소 |
| 주문완료 | 주문취소, 결제취소 |
| 주문취소 | - |
| 결제취소 | - |

---

### 2-2. 결제 처리 규칙

- 결제 완료:
  - `meta.payment.paid = true`
  - `status` 변경 없음
- 결제 취소:
  - `status = 결제취소`
  - `meta.cancel.reason` 필수

---

### 2-3. 주문 취소

- 상태가 `주문접수 / 준비중 / 주문완료` 일 때 가능
- 반드시 사유 입력 필요
- 결제 여부와 무관

---

## 3. 예약 주문 (type = reserve)

### 3-1. 상태 흐름

| 현재 상태 | 이동 가능 상태 |
|----------|----------------|
| 입금 미확인 | 주문접수, 주문취소 |
| 주문접수 | 준비중, 주문취소 |
| 준비중 | 주문완료, 주문취소 |
| 주문완료 | - |
| 주문취소 | - |

---

## 4. 데이터 구조 (고정)

### 4-1. Order.status

```json
"status": "주문접수 | 준비중 | 주문완료 | 주문취소 | 결제취소"



### 4-2. meta.payment
"meta": {
  "payment": {
    "paid": true,
    "paidAt": "ISO8601",
    "method": "POS | TOSS | CASH"
  }
}

### 4-3. meta.cancel
"meta": {
  "cancel": {
    "reason": "고객 요청",
    "at": "ISO8601"
  }
}


### 5. DB 전환 시 유지 규칙

status / meta 구조는 변경하지 않는다

API는 PUT /api/orders 로 동일하게 유지

검증 로직은 서버에서 단일 책임으로 처리

---

## ✅ 여기까지 하면 4단계-1 완료

지금 이 단계에서 **아직 코드 수정 없음**  
→ **기준만 고정**

---완료


