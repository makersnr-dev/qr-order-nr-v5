<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link rel="stylesheet" href="/src/admin/assets/css/style.css"/>
  <link rel="stylesheet" href="/src/admin/assets/css/override-white.css"/>
  <title>관리자 콘솔</title>
</head>

<body>
<div id="admin-toast-box" style="position:fixed; top:16px; right:16px; z-index:10001; display:flex; flex-direction:column; gap:8px;"></div>

<div class="container">
  <div class="hstack">
    <h1>관리자 콘솔</h1>
    <span class="badge right">매장</span>
    <span class="badge">예약</span>
    <button id="logoutBtn" class="btn">로그아웃</button>
  </div>

  <div class="tabbar">
    <button class="tab active" data-tab="store">매장</button>
    <button class="tab" data-tab="delivery">예약</button>
    <button class="tab" data-tab="qr-store">매장QR</button>
    <button class="tab" data-tab="qr-deliv">예약QR</button>
    <button class="tab" data-tab="menu">메뉴 관리</button>
    <button class="tab" data-tab="code">결제 코드</button>
    <button class="tab" data-tab="mybank">내 계좌정보</button>
    <button class="tab" data-tab="notify-log">호출 알림</button>
    <button class="tab" data-tab="notify">알림 설정</button>
    <button class="tab" data-tab="privacy">개인정보 처리방침</button>
  </div>

  <div class="card" data-panel="store">
    <div class="hstack" style="justify-content:space-between;margin-bottom:6px">
      <h3>매장 주문</h3>
      <button id="store-refresh" class="btn small">새로고침</button>
    </div>
    <table class="table">
      <thead><tr><th>일시</th><th>테이블</th><th>내역</th><th>금액</th><th>상태</th></tr></thead>
      <tbody id="tbody-store"></tbody>
    </table>
  </div>

  <div class="card" data-panel="delivery" style="display:none">
    <div class="hstack" style="justify-content:space-between;margin-bottom:6px">
      <h3>예약 주문</h3>
      <button id="deliv-refresh" class="btn small">새로고침</button>
    </div>
    <table class="table">
      <thead><tr><th>일시</th><th>주문자</th><th>연락처</th><th>주소</th><th>구매내역</th><th>상태</th></tr></thead>
      <tbody id="tbody-deliv"></tbody>
    </table>
  </div>

  <div class="card" data-panel="qr-store" style="display:none">
    <h3>매장 QR 관리</h3>
    <div class="hstack" style="gap:10px; margin-bottom:20px;">
      <input id="qr-table" class="input" placeholder="테이블 번호" style="width:120px">
      <button id="qr-generate" class="btn primary">생성</button>
      <button id="qr-clear" class="btn danger">전체삭제</button>
    </div>
    <div id="qr-grid" class="grid"></div>
  </div>

  <div class="card" data-panel="qr-deliv" style="display:none">
    <h3>예약용 QR 관리</h3>
    <div class="hstack" style="gap:10px; margin-bottom:20px;">
      <input id="qr-deliv-label" class="input" placeholder="QR 라벨" style="width:200px">
      <button id="qr-deliv-generate" class="btn primary">생성</button>
      <button id="qr-deliv-clear" class="btn danger">전체삭제</button>
    </div>
    <div id="qr-deliv-grid" class="grid"></div>
  </div>

  <div class="card" data-panel="menu" style="display:none">
    <h3>메뉴 관리</h3>
    <div class="hstack" style="gap:8px; margin-bottom:16px;">
      <input id="m-id" class="input" placeholder="ID" style="width:80px">
      <input id="m-name" class="input" placeholder="메뉴명">
      <input id="m-price" class="input" type="number" placeholder="가격" style="width:100px">
      <button id="m-add" class="btn primary">추가</button>
      <input type="file" id="menu-excel" style="display:none">
      <button id="menu-excel-upload" class="btn">엑셀업로드</button>
    </div>
    <table class="table">
      <thead><tr><th>ID</th><th>메뉴명</th><th>가격</th><th>상태</th><th class="right">관리</th></tr></thead>
      <tbody id="m-body"></tbody>
    </table>
  </div>

  <div class="card" data-panel="code" style="display:none">
    <h3>오늘의 결제 코드</h3>
    <div class="hstack" style="margin-top:20px">
      <span id="code-date" class="small"></span>
      <input id="code-input" class="input" readonly style="font-size:24px; width:120px; text-align:center;">
      <button id="code-copy" class="btn">복사</button>
      <button id="code-new" class="btn primary">갱신</button>
    </div>
  </div>

  <div class="card" data-panel="mybank" style="display:none">
    <h3>입금 계좌 설정</h3>
    <div class="vstack" style="max-width:400px; margin-top:20px">
      <input id="mb-bank" class="input" placeholder="은행명">
      <input id="mb-acct" class="input" placeholder="계좌번호">
      <input id="mb-holder" class="input" placeholder="예금주">
      <button id="mb-save" class="btn primary">정보 저장</button>
      <div class="small">현재: <span id="mb-current" style="color:var(--primary)">-</span></div>
    </div>
  </div>

  <div class="card" data-panel="notify-log" style="display:none">
    <div class="hstack" style="justify-content:space-between">
      <h3>직원 호출 기록</h3>
      <button id="notify-log-refresh" class="btn small">새로고침</button>
    </div>
    <table class="table"><tbody id="tbody-notify-logs"></tbody></table>
  </div>

  <div class="card" data-panel="notify" style="display:none">
    <h3>알림 설정</h3>
    <div class="vstack" style="max-width:500px; margin-top:20px">
      <label><input type="checkbox" id="n-beep"> 알림음 재생</label>
      <input type="range" id="n-vol" min="0" max="1" step="0.1">
      <label><input type="checkbox" id="n-desktop"> 데스크탑 알림</label>
      <div id="call-options-box" class="vstack"></div>
      <button id="n-save" class="btn primary">설정 저장</button>
    </div>
  </div>

  <div class="card" data-panel="privacy" style="display:none">
    <h3>개인정보 처리방침</h3>
    <textarea id="privacy-text" class="input" style="width:100%; min-height:300px; margin-top:10px;"></textarea>
    <button id="privacy-save" class="btn primary">저장</button>
  </div>
</div>

<div id="order-detail-modal" class="modal" style="display:none">
  <div class="content">
    <h3>주문 상세</h3>
    <pre id="order-detail-body" class="small" style="white-space:pre-wrap; background:#0b1620; padding:10px;"></pre>
    <button id="order-detail-close" class="btn" style="width:100%">닫기</button>
  </div>
</div>

<div id="cancel-reason-modal" class="modal" style="display:none">
  <div class="content">
    <h3>취소 사유</h3>
    <textarea id="cancel-reason-input" class="input" placeholder="사유 입력"></textarea>
    <div class="hstack" style="justify-content:flex-end; gap:8px; margin-top:10px;">
      <button id="cancel-reason-close" class="btn">취소</button>
      <button id="cancel-reason-confirm" class="btn danger">확인</button>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs/qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<script type="module">
  import { ensureStoreInitialized } from '/src/shared/store.js';
  const storeId = ensureStoreInitialized();
  window.qrnrStoreId = storeId;
  document.body.dataset.storeId = storeId;
  const url = new URL(location.href);
  if (!url.searchParams.get('store')) {
    url.searchParams.set('store', storeId);
    history.replaceState(null, '', url.toString());
  }
</script>
<script type="module" src="/src/admin/assets/js/admin.js"></script>
</body>
</html>
