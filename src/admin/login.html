<!doctype html><html lang="ko"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<link rel="stylesheet" href="/src/admin/assets/css/style.css"/>
<title>ê´€ë¦¬ì ë¡œê·¸ì¸</title>  <link rel="stylesheet" href="/src/admin/assets/css/override-white.css"/>
</head><body>
<div class="container">
  <h1>ê´€ë¦¬ì ë¡œê·¸ì¸</h1>
  <div class="card vstack" style="max-width:520px;margin:0 auto">
    <input id="uid" class="input" placeholder="ì•„ì´ë””">
    <input id="pwd" class="input" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸">
    <button id="login" class="btn primary">ë¡œê·¸ì¸</button>
  </div>
  <div class="small" style="text-align:center;margin-top:10px">
    ê³ ê° ë¡œê·¸ì¸ì€ <a href="/order/login">/order/login</a>
  </div>
</div>
<script type="module">
  import { get } from '/src/admin/assets/js/modules/store.js';
  import { saveToken } from '/src/admin/assets/js/modules/auth.js';

  document.getElementById('login').onclick = async () => {
    const uid = document.getElementById('uid').value.trim();
    const pwd = document.getElementById('pwd').value.trim();

    if (!uid || !pwd) {
      alert('ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
      return;
    }

    const res = await fetch('/api/login-admin', {
      method: 'POST',
      headers: { 'content-type': 'application/json' },
      body: JSON.stringify({ uid, pwd })
    });

    const data = await res.json().catch(() => ({}));

    if (!res.ok || !data.token) {
      alert('ë¡œê·¸ì¸ ì‹¤íŒ¨');
      return;
    }

    // í† í° ì €ì¥ (ê¸°ì¡´ ê·¸ëŒ€ë¡œ)
    saveToken(data.token);

    // ğŸ”¹ ë§¤ì¥ ë§¤í•‘ ì¡°íšŒ: store-admin í˜ì´ì§€ì—ì„œ ì €ì¥í•œ ê°’
    const map = get(['admin', 'storeAdmins']) || {};
    const storeId = map[uid];   // ì˜ˆ: { "admin1": "narae", "admin2": "korea" }

    // ğŸ”¹ ë§¤í•‘ì´ ìˆìœ¼ë©´ í•´ë‹¹ ë§¤ì¥ìœ¼ë¡œ, ì—†ìœ¼ë©´ ê¸°ë³¸ /admin
    if (storeId) {
      location.href = `/admin?store=${encodeURIComponent(storeId)}`;
    } else {
      location.href = '/admin';
    }
  };
</script>
</body></html>
