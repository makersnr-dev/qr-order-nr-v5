<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link rel="stylesheet" href="/src/admin/assets/css/style.css"/>
  <link rel="stylesheet" href="/src/admin/assets/css/override-white.css"/>
  <title>ê´€ë¦¬ì ë¡œê·¸ì¸</title>
</head>
<body>
<div class="container">
  <h1>ê´€ë¦¬ì ë¡œê·¸ì¸</h1>

  <div class="card vstack" style="max-width:520px;margin:0 auto">
    <input id="uid" class="input" placeholder="ì•„ì´ë””">
    <input id="pwd" class="input" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸">
    <button id="login" class="btn primary">ë¡œê·¸ì¸</button>
  </div>

  <div class="small" style="text-align:center;margin-top:10px">
    ê³ ê° ë¡œê·¸ì¸ì€ <a href="/order/login">/order/login</a>
  </div>
</div>

<!-- ê¸°ì¡´ script ë¶€ë¶„ì„ ì´ë ‡ê²Œ ìˆ˜ì • -->
<script type="module">
  const loginBtn = document.getElementById('login');

  loginBtn.onclick = async () => {
    const uid = document.getElementById('uid').value.trim();
    const pwd = document.getElementById('pwd').value.trim();

    if (!uid || !pwd) {
      alert('ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
      return;
    }

    try {
      const res = await fetch('/api/login-admin', {
        method: 'POST',
        headers: { 'content-type': 'application/json' },
        credentials: 'include',
        body: JSON.stringify({ id: uid, pw: pwd })
      });

      const data = await res.json();

      if (!res.ok || !data.ok) {
        // ğŸ”¥ ì—ëŸ¬ ë©”ì‹œì§€ ê°œì„ 
        if (data.message === "Admin is not mapped to any store") {
          alert('ì´ ê´€ë¦¬ì ê³„ì •ì€ ë§¤ì¥ì— ë§¤í•‘ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.\nìŠˆí¼ ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.');
        } else if (data.message === "invalid admin credentials") {
          alert('ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
        } else {
          alert('ë¡œê·¸ì¸ ì‹¤íŒ¨: ' + (data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
        }
        return;
      }

      // âœ… ë¡œê·¸ì¸ ì„±ê³µ - storeIdì™€ í•¨ê»˜ ì´ë™
      const storeId = data.storeId || 'store1';
      location.href = `/admin?store=${encodeURIComponent(storeId)}`;

    } catch (e) {
      console.error('Login error:', e);
      alert('ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
    }
  };
</script>

</body>
</html>
