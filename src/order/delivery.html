<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link rel="stylesheet" href="/src/admin/assets/css/style.css"/>
  <title>ë°°ë‹¬/ì˜ˆì•½</title>
</head>
<body>
<div class="container">
  <div class="hstack" style="justify-content:space-between">
    <h1>ë°°ë‹¬/ì˜ˆì•½</h1>
    <div class="hstack" style="gap:8px">
      <a class="btn" href="/src/order/mypage.html">ë§ˆì´í˜ì´ì§€</a>
      <!-- ì£¼ë¬¸ ìœ í˜• ì„ íƒ í˜ì´ì§€ëŠ” ë‚˜ì¤‘ì— ì œê±° ì˜ˆì •ì´ë‹ˆ ì¼ë‹¨ ì£¼ì„ -->
      <!-- <a class="btn" href="/src/order/select.html">ì£¼ë¬¸ ìœ í˜•</a> -->
    </div>
  </div>

  <div class="card hstack" style="gap:8px">
    <label><input type="radio" name="tab" id="tab-deliv" checked> ë°°ë‹¬(ê²°ì œ)</label>
    <label><input type="radio" name="tab" id="tab-resv"> ì˜ˆì•½(ë¬´ê²°ì œ)</label>
  </div>

  <div class="card vstack" id="form-box">
    <h3>ë°°ë‹¬/ì˜ˆì•½ ì •ë³´ <span class="small">*</span></h3>

    <div class="vstack" style="gap:10px">
      <!-- ë°°ì†¡ì§€ -->
      <div class="field-row">
        <div class="field-label addr-label">ë°°ì†¡ì§€</div>
        <div class="addr-wrap">
          <input id="addr" class="input" />
          <input id="addr-detail" class="input addr-detail" placeholder="ìƒì„¸ì£¼ì†Œ" />
        </div>
      </div>

      <!-- ì£¼ë¬¸ìëª… -->
      <div class="field-row">
        <div class="field-label">ì£¼ë¬¸ìëª…</div>
        <input id="cust" class="input" />
      </div>

      <!-- ì—°ë½ì²˜ -->
      <div class="field-row">
        <div class="field-label">ì—°ë½ì²˜</div>
        <input id="phone" class="input" placeholder="ìˆ«ìë§Œ ê¸°ì…" inputmode="numeric" />
      </div>

      <!-- ì¼ì + ì˜ˆì•½ì‹œê°„ (ì˜ˆì•½ì—ì„œë§Œ ì‚¬ìš©) -->
      <div class="field-row" id="date-row">
        <div class="field-label">ì¼ì</div>
        <div class="date-time-row">
          <input id="date" type="date" class="input date-input">
          <span class="time-label">ì˜ˆì•½ì‹œê°„</span>
          <select id="time-ap" class="input input-sm time-ap"></select>
          <select id="time-hh" class="input input-sm"></select>
          <select id="time-mm" class="input input-sm"></select>
        </div>
      </div>

      <!-- ìš”ì²­ì‚¬í•­ -->
      <div class="field-row">
        <div class="field-label">ìš”ì²­ì‚¬í•­</div>
        <textarea id="memo" class="input" rows="4"></textarea>
      </div>

      

      <!-- ì˜ˆì•½(ë¬´ê²°ì œ)ì¼ ë•Œë§Œ ë³´ì´ëŠ” ê³„ì¢Œ ì•ˆë‚´ -->
      <div id="bank-box" class="field-row small" style="display:none">
        <div class="field-label">ì…ê¸ˆê³„ì¢Œ</div>
        <div class="hstack" style="gap:6px;flex-wrap:wrap">
          <span id="bank-text"></span>
          <button class="btn" id="bank-copy" type="button">ë³µì‚¬</button>
        </div>
        <div class="small" style="margin-top:4px; color:#f97316;">
          â€» ì£¼ë¬¸ìëª…ìœ¼ë¡œ ì…ê¸ˆí•´ì£¼ì„¸ìš”!
        </div>
      </div>
    </div>
  </div>

  <div class="card vstack">
    <h3>ë©”ë‰´</h3>
    <div id="menu-grid" class="hstack" style="gap:12px;flex-wrap:wrap"></div>
  </div>

  <div class="card vstack">
    <h3>ì¥ë°”êµ¬ë‹ˆ</h3>
    <div id="cart-box" class="vstack"></div>
  </div>

  <div class="card hstack" style="justify-content:space-between">
    <div>í•©ê³„: <b id="total">0</b>ì›</div>
    <button id="action-btn" class="btn primary">ê²°ì œí•˜ê¸°</button>
  </div>
</div>

<!-- âœ… ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ ëª¨ë‹¬ -->
<div id="privacy-modal" style="
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.55);
  z-index:9998;
  align-items:center;
  justify-content:center;
">
  <div style="
    background:#020617;
    border-radius:12px;
    padding:16px 18px;
    max-width:520px;
    width:calc(100% - 40px);
    max-height:80vh;
    overflow:auto;
    box-shadow:0 10px 40px rgba(0,0,0,0.45);
    font-size:13px;
  ">
    <h3 style="margin:0 0 8px 0;">ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨</h3>
    <!-- ğŸ”¹ ë‚´ìš©ì€ JSì—ì„œ ê´€ë¦¬ì ì„¤ì •ê°’ìœ¼ë¡œ ì±„ì›€ -->
    <div id="privacy-modal-body" class="small" style="white-space:pre-wrap; line-height:1.5;"></div>
    <div class="hstack" style="justify-content:flex-end;margin-top:12px;gap:8px">
      <button type="button" id="privacy-close" class="btn">ë‹«ê¸°</button>
    </div>
  </div>
</div>

<!-- ë‹¤ìŒ ìš°í¸ë²ˆí˜¸ -->
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>

<script type="module">
  import { requireCust } from '/src/order/assets/js/modules/cust-auth.js';
  import { renderMenu, makeCart } from '/src/order/assets/js/modules/menu-cart.js';
  import { get } from '/src/order/assets/js/modules/cust-store.js';
  import { fillTimeSelectors, getTimeValue } from '/src/order/assets/js/modules/time.js';
  import { setPendingOrder, startPayment } from '/src/shared/toss-client.js';

  await requireCust();

  // URL íŒŒë¼ë¯¸í„°
  const url = new URL(location.href);
  const storeId = url.searchParams.get('store') || 'store1';

  // âœ… ê¸°ë³¸ ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ (ê´€ë¦¬ìì—ì„œ ì•„ë¬´ ê²ƒë„ ì €ì¥ ì•ˆ í–ˆì„ ë•Œ fallback)
  const defaultPrivacyText = `
[ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨]

QR ì£¼ë¬¸Â·ë°°ë‹¬/ì˜ˆì•½ ì„œë¹„ìŠ¤(ì´í•˜ "ì„œë¹„ìŠ¤")ëŠ” ã€Œê°œì¸ì •ë³´ ë³´í˜¸ë²•ã€, 
ã€Œì •ë³´í†µì‹ ë§ ì´ìš©ì´‰ì§„ ë° ì •ë³´ë³´í˜¸ ë“±ì— ê´€í•œ ë²•ë¥ ã€ ë“± ê´€ë ¨ ë²•ë ¹ì„ ì¤€ìˆ˜í•˜ë©°,
ì´ìš©ìì˜ ê°œì¸ì •ë³´ë¥¼ ì•ˆì „í•˜ê²Œ ë³´í˜¸í•˜ê¸° ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì´ ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ì„ ìˆ˜ë¦½Â·ìš´ì˜í•©ë‹ˆë‹¤.

1. ìˆ˜ì§‘í•˜ëŠ” ê°œì¸ì •ë³´ í•­ëª©
1) í•„ìˆ˜ í•­ëª©
  - ì£¼ë¬¸ì ì •ë³´: ì´ë¦„, ì—°ë½ì²˜(íœ´ëŒ€ì „í™” ë²ˆí˜¸)
  - ë°°ì†¡/ë°©ë¬¸ ì •ë³´: ì£¼ì†Œ(ë°°ë‹¬ ì‹œ), ì˜ˆì•½ ì¼ì ë° ì‹œê°„(ì˜ˆì•½ ì‹œ)
  - ì£¼ë¬¸ ì •ë³´: ì£¼ë¬¸ ë©”ë‰´, ìˆ˜ëŸ‰, ê²°ì œ ê¸ˆì•¡, ì£¼ë¬¸ ìœ í˜•(ë§¤ì¥/ë°°ë‹¬/ì˜ˆì•½) ë“±

2) ìë™ìœ¼ë¡œ ìƒì„±Â·ìˆ˜ì§‘ë  ìˆ˜ ìˆëŠ” ì •ë³´
  - ì„œë¹„ìŠ¤ ì´ìš© ê¸°ë¡, ì ‘ì† ì¼ì‹œ, ë¸Œë¼ìš°ì € ì¢…ë¥˜ ë“±(ë¡œê·¸ ë¶„ì„ ë° ë³´ì•ˆ ëª©ì )

2. ê°œì¸ì •ë³´ì˜ ìˆ˜ì§‘Â·ì´ìš© ëª©ì 
ì„œë¹„ìŠ¤ëŠ” ìˆ˜ì§‘í•œ ê°œì¸ì •ë³´ë¥¼ ë‹¤ìŒì˜ ëª©ì  ë²”ìœ„ ë‚´ì—ì„œë§Œ ì´ìš©í•©ë‹ˆë‹¤.
  1) ì£¼ë¬¸ ì ‘ìˆ˜ ë° ì²˜ë¦¬, ë°°ë‹¬/ë°©ë¬¸ ì˜ˆì•½ ê´€ë¦¬
  2) ì£¼ë¬¸ ë‚´ì—­ í™•ì¸ ë° ë³€ê²½, ì·¨ì†Œ ë“± ê³ ê° ìš”ì²­ ì²˜ë¦¬
  3) ë°°ë‹¬/ë°©ë¬¸ ì¼ì • ì•ˆë‚´, ì£¼ë¬¸ ê´€ë ¨ ê³ ì§€Â·ì•ˆë‚´
  4) ë¯¼ì› ì²˜ë¦¬ ë° ë¶„ìŸ ë°œìƒ ì‹œ ì‚¬ì‹¤ ê´€ê³„ í™•ì¸
  5) ì„œë¹„ìŠ¤ í’ˆì§ˆ í–¥ìƒ ë° ìš´ì˜ ê´€ë¦¬(í†µê³„Â·ë¶„ì„ ë“±, ê°œì¸ ì‹ë³„ì´ ë¶ˆê°€ëŠ¥í•œ í˜•íƒœë¡œ ì²˜ë¦¬)

3. ê°œì¸ì •ë³´ì˜ ë³´ìœ  ë° ì´ìš© ê¸°ê°„
ì„œë¹„ìŠ¤ëŠ” ê´€ë ¨ ë²•ë ¹ì—ì„œ ì •í•œ ê¸°ê°„ ë™ì•ˆ ê°œì¸ì •ë³´ë¥¼ ë³´ìœ Â·ì´ìš©í•˜ë©°,
ê·¸ ì´í›„ì—ëŠ” ì§€ì²´ ì—†ì´ ì•ˆì „í•œ ë°©ë²•ìœ¼ë¡œ íŒŒê¸°í•©ë‹ˆë‹¤.

1) ì „ììƒê±°ë˜ ë“±ì—ì„œì˜ ì†Œë¹„ì ë³´í˜¸ì— ê´€í•œ ë²•ë¥ ì— ë”°ë¥¸ ë³´ì¡´ ê¸°ê°„
  - ê³„ì•½ ë˜ëŠ” ì²­ì•½ì² íšŒ ë“±ì— ê´€í•œ ê¸°ë¡: 5ë…„
  - ëŒ€ê¸ˆ ê²°ì œ ë° ì¬í™” ë“±ì˜ ê³µê¸‰ì— ê´€í•œ ê¸°ë¡: 5ë…„
  - ì†Œë¹„ìì˜ ë¶ˆë§Œ ë˜ëŠ” ë¶„ìŸ ì²˜ë¦¬ì— ê´€í•œ ê¸°ë¡: 3ë…„

2) ê¸°íƒ€ ê´€ë ¨ ë²•ë ¹ì— ë”°ë¥¸ ë³´ì¡´ ê¸°ê°„
  - ê´€ê³„ ë²•ë ¹ì— ë”°ë¼ ì¶”ê°€ ë³´ê´€ì´ í•„ìš”í•œ ê²½ìš°, í•´ë‹¹ ë²•ì—ì„œ ì •í•œ ê¸°ê°„ ë™ì•ˆ ë³´ê´€í•©ë‹ˆë‹¤.

4. ê°œì¸ì •ë³´ì˜ ì œ3ì ì œê³µ
ì„œë¹„ìŠ¤ëŠ” ì›ì¹™ì ìœ¼ë¡œ ì´ìš©ìì˜ ë™ì˜ ì—†ì´ ê°œì¸ì •ë³´ë¥¼ ì œ3ìì—ê²Œ ì œê³µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
ë‹¤ë§Œ, ë‹¤ìŒì˜ ê²½ìš°ì—ëŠ” ì˜ˆì™¸ë¡œ í•©ë‹ˆë‹¤.
  1) ì´ìš©ìê°€ ì‚¬ì „ì— ì œ3ì ì œê³µì— ëª…ì‹œì ìœ¼ë¡œ ë™ì˜í•œ ê²½ìš°
  2) ë²•ë ¹ì— ê·¼ê±°ê°€ ìˆê±°ë‚˜, ìˆ˜ì‚¬ê¸°ê´€Â·ê°ë…ê¸°ê´€ ë“±ì˜ ì ë²•í•œ ìš”êµ¬ê°€ ìˆëŠ” ê²½ìš°
  3) ê¸°íƒ€ ê´€ë ¨ ë²•ë ¹ì—ì„œ í—ˆìš©í•˜ëŠ” ê²½ìš°

5. ê°œì¸ì •ë³´ ì²˜ë¦¬ì˜ ìœ„íƒ
ì„œë¹„ìŠ¤ëŠ” ì£¼ë¬¸ ì²˜ë¦¬, ì‹œìŠ¤í…œ ìš´ì˜, ì•Œë¦¼ ë°œì†¡ ë“± ì„œë¹„ìŠ¤ ì œê³µì„ ìœ„í•˜ì—¬
ì¼ë¶€ ì—…ë¬´ë¥¼ ì™¸ë¶€ ì „ë¬¸ ì—…ì²´ì— ìœ„íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì´ ê²½ìš°, ë‹¤ìŒ ì‚¬í•­ì„ í¬í•¨í•˜ì—¬ ê´€ê³„ ë²•ë ¹ì— ë”°ë¼ ìœ„íƒ ê³„ì•½ì„ ì²´ê²°í•˜ê³ 
ìˆ˜íƒìê°€ ê°œì¸ì •ë³´ë¥¼ ì•ˆì „í•˜ê²Œ ê´€ë¦¬í•˜ë„ë¡ ê°ë…í•©ë‹ˆë‹¤.
  1) ìœ„íƒë°›ëŠ” ì(ìˆ˜íƒì)
  2) ìœ„íƒ ì—…ë¬´ì˜ ë‚´ìš©
  3) ì¬ìœ„íƒ ì œí•œ, ì•ˆì „ì„± í™•ë³´ ì¡°ì¹˜, ì†í•´ë°°ìƒ ì±…ì„ ë“±

â€» ì‹¤ì œ ìœ„íƒì„ ì§„í–‰í•˜ëŠ” ê²½ìš°, ìœ„íƒ ì—…ì²´ ëª…ì¹­ê³¼ ì—…ë¬´ ë‚´ìš©ì„ ë³„ë„ ê³µì§€ ë˜ëŠ” ì•ˆë‚´ë¬¸ì„ í†µí•´ ê³ ì§€í•©ë‹ˆë‹¤.

6. ì´ìš©ì ë° ë²•ì •ëŒ€ë¦¬ì¸ì˜ ê¶Œë¦¬ì™€ í–‰ì‚¬ ë°©ë²•
ì´ìš©ìëŠ” ì–¸ì œë“ ì§€ ìì‹ ì˜ ê°œì¸ì •ë³´ì— ëŒ€í•˜ì—¬ ë‹¤ìŒ ê° í˜¸ì˜ ê¶Œë¦¬ë¥¼ í–‰ì‚¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  1) ê°œì¸ì •ë³´ ì—´ëŒ ìš”êµ¬
  2) ê°œì¸ì •ë³´ ì •ì •Â·ì‚­ì œ ìš”êµ¬
  3) ê°œì¸ì •ë³´ ì²˜ë¦¬ ì •ì§€ ìš”êµ¬

ìœ„ ê¶Œë¦¬ í–‰ì‚¬ëŠ” ë§¤ì¥ ìš´ì˜ì ë˜ëŠ” ì„œë¹„ìŠ¤ ê´€ë¦¬ìë¡œ ë¬¸ì˜í•˜ì—¬ ìš”ì²­í•  ìˆ˜ ìˆìœ¼ë©°,
ì„œë¹„ìŠ¤ëŠ” ì§€ì²´ ì—†ì´ í•„ìš”í•œ ì¡°ì¹˜ë¥¼ ì·¨í•©ë‹ˆë‹¤.
ë‹¤ë§Œ, ë²•ë ¹ì—ì„œ ë³„ë„ë¡œ ì •í•œ ê²½ìš°ì—ëŠ” ì¼ë¶€ ê¶Œë¦¬ê°€ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

7. ê°œì¸ì •ë³´ì˜ íŒŒê¸° ì ˆì°¨ ë° ë°©ë²•
ì„œë¹„ìŠ¤ëŠ” ë³´ìœ  ê¸°ê°„ì´ ê²½ê³¼í•˜ê±°ë‚˜ ì²˜ë¦¬ ëª©ì ì´ ë‹¬ì„±ëœ ê²½ìš°, ì§€ì²´ ì—†ì´ í•´ë‹¹ ì •ë³´ë¥¼ íŒŒê¸°í•©ë‹ˆë‹¤.

1) íŒŒê¸° ì ˆì°¨
  - íŒŒê¸° ì‚¬ìœ ê°€ ë°œìƒí•œ ê°œì¸ì •ë³´ë¥¼ ì„ ì •í•˜ê³ , ë‚´ë¶€ ê·œì •ì— ë”°ë¼ íŒŒê¸°í•©ë‹ˆë‹¤.

2) íŒŒê¸° ë°©ë²•
  - ì „ìì  íŒŒì¼ í˜•íƒœ: ë³µêµ¬ ë˜ëŠ” ì¬ìƒì´ ë¶ˆê°€ëŠ¥í•œ ë°©ë²•ìœ¼ë¡œ ì˜êµ¬ ì‚­ì œ
  - ì¢…ì´ ë¬¸ì„œ ë“±: ë¶„ì‡„ ë˜ëŠ” ì†Œê° ë“± ë¬¼ë¦¬ì  íŒŒê¸°

8. ê°œì¸ì •ë³´ì˜ ì•ˆì „ì„± í™•ë³´ ì¡°ì¹˜
ì„œë¹„ìŠ¤ëŠ” ê°œì¸ì •ë³´ì˜ ì•ˆì „í•œ ì²˜ë¦¬ë¥¼ ìœ„í•˜ì—¬ ë‹¤ìŒê³¼ ê°™ì€ ë³´í˜¸ ì¡°ì¹˜ë¥¼ ì·¨í•©ë‹ˆë‹¤.
  1) ì ‘ê·¼ ê¶Œí•œ ê´€ë¦¬: ê°œì¸ì •ë³´ì— ëŒ€í•œ ì ‘ê·¼ ê¶Œí•œì„ ìµœì†Œí•œìœ¼ë¡œ ë¶€ì—¬í•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤.
  2) ë³´ì•ˆ í”„ë¡œê·¸ë¨ ì‚¬ìš©: ì•…ì„±ì½”ë“œ ë° í•´í‚¹ ë°©ì§€ë¥¼ ìœ„í•œ ë³´ì•ˆ í”„ë¡œê·¸ë¨ì„ ì„¤ì¹˜Â·ìš´ì˜í•©ë‹ˆë‹¤.
  3) ì ‘ì† ê¸°ë¡ ë³´ê´€: ê°œì¸ì •ë³´ ì²˜ë¦¬ ì‹œìŠ¤í…œì— ëŒ€í•œ ì ‘ì† ê¸°ë¡ì„ ë³´ê´€Â·ê´€ë¦¬í•©ë‹ˆë‹¤.
  4) ê¸°íƒ€ ê¸°ìˆ ì Â·ê´€ë¦¬ì  ë³´í˜¸ ì¡°ì¹˜: ê´€ë ¨ ë²•ë ¹ì—ì„œ ìš”êµ¬í•˜ëŠ” ë³´í˜¸ ì¡°ì¹˜ë¥¼ ì§€ì†ì ìœ¼ë¡œ ì´í–‰í•©ë‹ˆë‹¤.

9. ê°œì¸ì •ë³´ ë³´í˜¸ ì±…ì„ì ë° ì—°ë½ì²˜
ì´ìš©ìëŠ” ê°œì¸ì •ë³´ ë³´í˜¸ ê´€ë ¨ ë¬¸ì˜, ë¶ˆë§Œ ì²˜ë¦¬, í”¼í•´ êµ¬ì œ ë“±ì„ ìœ„í•˜ì—¬
ì•„ë˜ ì—°ë½ì²˜ë¡œ ë¬¸ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

  - ê°œì¸ì •ë³´ ë³´í˜¸ ì±…ì„ì: (ë§¤ì¥ ìš´ì˜ì ë˜ëŠ” ê´€ë¦¬ì ì´ë¦„)
  - ì—°ë½ì²˜: (ì „í™”ë²ˆí˜¸ ë˜ëŠ” ì´ë©”ì¼ ë“± ê¸°ì¬)
  - ì£¼ì†Œ: (ë§¤ì¥ ì£¼ì†Œ ë˜ëŠ” ì‚¬ì—…ì¥ ì£¼ì†Œ ê¸°ì¬)

10. ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ì˜ ë³€ê²½
ë³¸ ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ì€ ê´€ë ¨ ë²•ë ¹, ì„œë¹„ìŠ¤ ì •ì±… ë³€í™”ì— ë”°ë¼ ê°œì •ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì¤‘ìš”í•œ ë‚´ìš©ì˜ ë³€ê²½ì´ ìˆëŠ” ê²½ìš°, ì„œë¹„ìŠ¤ í™”ë©´ ë˜ëŠ” ë³„ë„ ê³µì§€ ë“±ì„ í†µí•˜ì—¬
ê°œì • ë‚´ìš©ê³¼ ì‹œí–‰ ì‹œê¸°ë¥¼ ì‚¬ì „ì— ì•ˆë‚´í•©ë‹ˆë‹¤.

â€» ë³¸ ì˜ˆì‹œëŠ” ì¼ë°˜ì ì¸ ë§¤ì¥ QR ì£¼ë¬¸Â·ë°°ë‹¬/ì˜ˆì•½ ì„œë¹„ìŠ¤ ìƒí™©ì„ ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±ëœ ì˜ˆì‹œì´ë©°,
  ì‹¤ì œ ì‚¬ì—…ìì˜ í˜•íƒœ, ì„œë¹„ìŠ¤ êµ¬ì¡°, ë²•ë¥  ìë¬¸ ê²°ê³¼ ë“±ì— ë”°ë¼
  ì¼ë¶€ ìˆ˜ì •Â·ë³´ì™„ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  `.trim();

  // âœ… ê´€ë¦¬ìì—ì„œ ì €ì¥í•œ ì •ì±…ì„ ë¶ˆëŸ¬ì™€ ëª¨ë‹¬ì— ì ìš©
  function applyPrivacyText() {
    const el = document.getElementById('privacy-modal-body');
    if (!el) return;

    const fromAdmin =
      get(['admin', 'privacyPolicy', storeId]) ||
      get(['admin', 'privacyPolicy']) ||
      get(['system', 'privacyPolicy', storeId]) ||
      get(['system', 'privacyPolicy']) ||
      '';

    el.textContent = fromAdmin || defaultPrivacyText;
  }

  applyPrivacyText();

  // ì‹œê°„ ì„ íƒ ì…‹ì—… (ì˜ˆì•½ì—ì„œë§Œ ì‚¬ìš©í•˜ì§€ë§Œ ë¯¸ë¦¬ ì±„ì›Œë‘ê¸°)
  fillTimeSelectors('time');

  // ì¥ë°”êµ¬ë‹ˆ / ë©”ë‰´
  const cart = makeCart('cart-box', 'total');
  cart.render();
  renderMenu('menu-grid', cart);

  // âœ… í† ìŠ¤íŠ¸ UI: ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤ í‘œê¸°ìš©
  let copyToastTimer = null;
  function showCopyToast(message = 'ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.') {
    let box = document.getElementById('copy-toast');
    if (!box) {
      box = document.createElement('div');
      box.id = 'copy-toast';
      box.style.position = 'fixed';
      box.style.left = '50%';
      box.style.bottom = '24px';
      box.style.transform = 'translateX(-50%)';
      box.style.padding = '8px 16px';
      box.style.borderRadius = '999px';
      box.style.fontSize = '13px';
      box.style.background = 'rgba(0,0,0,0.75)';
      box.style.color = '#fff';
      box.style.zIndex = '9999';
      box.style.opacity = '0';
      box.style.transition = 'opacity 0.2s ease';
      document.body.appendChild(box);
    }
    box.textContent = message;

    if (copyToastTimer) {
      clearTimeout(copyToastTimer);
      copyToastTimer = null;
    }

    requestAnimationFrame(() => {
      box.style.opacity = '1';
      copyToastTimer = setTimeout(() => {
        box.style.opacity = '0';
      }, 3000);
    });
  }

  // íƒ­ ì „í™˜ UI
  function updateTab() {
    const isResv = document.getElementById('tab-resv').checked;

    // ë§¤ì¥ë³„ ê³„ì¢Œì •ë³´ (ì‹ ê·œ êµ¬ì¡°) â†’ ì—†ìœ¼ë©´ êµ¬ êµ¬ì¡° fallback
    const bank =
      get(['admin', 'ownerBank', storeId]) ||
      get(['admin', 'ownerBank']) ||
      { bank:'', number:'', holder:'' };

    document.getElementById('bank-box').style.display = isResv ? 'block' : 'none';
    document.getElementById('action-btn').textContent = isResv ? 'ì˜ˆì•½í•˜ê¸°' : 'ê²°ì œí•˜ê¸°';

    document.getElementById('bank-text').textContent =
      bank.bank && bank.number
        ? `${bank.bank} ${bank.number} (${bank.holder || ''})`
        : '(ê´€ë¦¬ìì— ê³„ì¢Œ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤)';

    const dateRow = document.getElementById('date-row');
    if (dateRow) {
      dateRow.style.display = isResv ? '' : 'none';
    }
  }

  ['tab-deliv','tab-resv'].forEach(id => {
    document.getElementById(id).addEventListener('change', updateTab);
  });
  updateTab();

  // âœ… ê³„ì¢Œ ë³µì‚¬ + í† ìŠ¤íŠ¸
  const bankCopyBtn = document.getElementById('bank-copy');
  if (bankCopyBtn) {
    bankCopyBtn.onclick = async () => {
      const txt = document.getElementById('bank-text').textContent.trim();
      if (!txt || txt.startsWith('(ê´€ë¦¬ìì— ê³„ì¢Œ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤')) {
        alert('ë³µì‚¬í•  ê³„ì¢Œ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      try {
        await navigator.clipboard.writeText(txt);
        showCopyToast('ê³„ì¢Œë²ˆí˜¸ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
      } catch (e) {
        console.error('clipboard error', e);
        showCopyToast('ë³µì‚¬ë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.');
      }
    };
  }

  // ì£¼ì†Œ ê²€ìƒ‰
  function openAddrSearch() {
    if (!window.daum || !window.daum.Postcode) {
      alert('ì£¼ì†Œ ê²€ìƒ‰ ì„œë¹„ìŠ¤ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
      return;
    }
    new window.daum.Postcode({
      oncomplete: function (data) {
        const addrInput = document.getElementById('addr');
        if (!addrInput) return;
        const addr = data.roadAddress || data.jibunAddress || data.address || '';
        addrInput.value = addr;
        addrInput.focus();
      },
    }).open();
  }

  const addrLabel = document.querySelector('.addr-label');
  if (addrLabel) {
    addrLabel.addEventListener('click', openAddrSearch);
    addrLabel.classList.add('clickable-label');
  }

  const addrInput = document.getElementById('addr');
  if (addrInput) {
    addrInput.addEventListener('click', () => {
      if (!addrInput.value) openAddrSearch();
    });
  }

  function formatPhone(raw) {
    const digits = String(raw || '').replace(/\D/g, '');
    if (digits.length === 10) return digits.replace(/(\d{3})(\d{3})(\d{4})/, '$1-$2-$3');
    if (digits.length === 11) return digits.replace(/(\d{3})(\d{4})(\d{4})/, '$1-$2-$3');
    return digits;
  }

  const phoneInput = document.getElementById('phone');
  if (phoneInput) {
    phoneInput.addEventListener('input', () => {
      const digits = phoneInput.value.replace(/\D/g, '');
      phoneInput.value = digits;
    });
    phoneInput.addEventListener('blur', () => {
      const formatted = formatPhone(phoneInput.value);
      phoneInput.value = formatted || phoneInput.value;
    });
  }

  // âœ… ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ ëª¨ë‹¬ ì—´ê¸°/ë‹«ê¸°
  const privacyModal = document.getElementById('privacy-modal');
  const privacyOpen  = document.getElementById('privacy-open');
  const privacyClose = document.getElementById('privacy-close');

  if (privacyOpen && privacyModal) {
    privacyOpen.addEventListener('click', () => {
      // í˜¹ì‹œ ê´€ë¦¬ìì—ì„œ ë°©ê¸ˆ ìˆ˜ì •í–ˆì„ ìˆ˜ë„ ìˆìœ¼ë‹ˆ, ì—´ê¸° ì§ì „ì— í•œ ë²ˆ ë” ì ìš©
      applyPrivacyText();
      privacyModal.style.display = 'flex';
    });
  }
  if (privacyClose && privacyModal) {
    privacyClose.addEventListener('click', () => {
      privacyModal.style.display = 'none';
    });
  }
  if (privacyModal) {
    privacyModal.addEventListener('click', (e) => {
      if (e.target === privacyModal) {
        privacyModal.style.display = 'none';
      }
    });
  }

  // í•©ê³„ ê³„ì‚°
  function totalAmount() {
    if (typeof cart.total === 'function') return cart.total();
    if (Array.isArray(cart.items)) {
      return cart.items.reduce((s,i)=>s + Number(i.price||0)*Number(i.qty||1),0);
    }
    return 0;
  }

  // ë©”ì¸ ë²„íŠ¼(ê²°ì œ/ì˜ˆì•½)
  document.getElementById('action-btn').onclick = async (e) => {
    e.preventDefault();

    const addrBase    = document.getElementById('addr').value.trim();
    const addrDetail  = (document.getElementById('addr-detail')?.value || '').trim();
    const addr        = addrDetail ? `${addrBase} ${addrDetail}` : addrBase;

    const cust        = document.getElementById('cust').value.trim();
    const rawPhone    = document.getElementById('phone').value.trim();
    const digitsPhone = rawPhone.replace(/\D/g, '');

    const dateInput   = document.getElementById('date').value;
    const memo        = document.getElementById('memo').value.trim();
    const isResv      = document.getElementById('tab-resv').checked;

    const agreePrivacy = document.getElementById('agree-privacy')?.checked ?? false;

    const items = cart.items || [];

    if (!items.length) {
      alert('ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.');
      return;
    }
    if (!addr || !cust) {
      alert('ì£¼ì†Œ / ì£¼ë¬¸ìëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }
    if (digitsPhone.length < 10) {
      alert('ì—°ë½ì²˜ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”. ìˆ«ì 10ìë¦¬ ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      document.getElementById('phone').focus();
      return;
    }
    if (!agreePrivacy) {
      alert('ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš©ì— ë™ì˜í•´ ì£¼ì„¸ìš”.');
      const agreeBox = document.getElementById('agree-privacy');
      if (agreeBox) agreeBox.focus();
      return;
    }

    const phone = formatPhone(rawPhone);

    const { ap, hh, mm } = getTimeValue('time') || {};
    const hasTime =
      ap && hh && mm &&
      hh !== 'ì‹œ' && mm !== 'ë¶„' &&
      hh !== '' && mm !== '';

    let reserveDate = null;
    let reserveTime = null;

    // ğŸ”¹ ì˜ˆì•½(ë¬´ê²°ì œ)
    if (isResv) {
      if (!dateInput) {
        alert('ì˜ˆì•½ ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }
      if (!hasTime) {
        alert('ì˜ˆì•½ ì‹œê°„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }

      reserveDate = dateInput;
      reserveTime = `${ap} ${hh}:${mm}`;

      const payload = {
        type: 'reserve',
        amount: totalAmount(),
        orderName: 'ì˜ˆì•½ ì£¼ë¬¸',
        cart: items,
        customer: { name: cust, phone, addr, req: memo },
        reserveDate,
        reserveTime,
        status: 'ëŒ€ê¸°',
        storeId,
        agreePrivacy: true,
      };

      try {
        const res = await fetch('/api/orders', {
          method: 'POST',
          headers: { 'content-type': 'application/json' },
          body: JSON.stringify(payload),
        });
        const data = await res.json();
        if (!data.ok) throw new Error('save failed');

        const back = location.pathname + location.search;
        location.replace(`/src/order/reserve-success.html?returnTo=${encodeURIComponent(back)}`);
      } catch (err) {
        console.error('reserve save err', err);
        alert('ì˜ˆì•½ ì •ë³´ë¥¼ ì €ì¥í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
      }
      return;
    }

    // ğŸ”¹ ë°°ë‹¬(ê²°ì œ)
    const total = totalAmount();
    if (!total) {
      alert('ê²°ì œ ê¸ˆì•¡ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
      return;
    }

    const orderId = 'DELIV-' + Date.now();
    const orderName = 'ë°°ë‹¬ ì£¼ë¬¸';

    const pendingPayload = {
      type: 'delivery',
      amount: total,
      orderName,
      cart: items,
      customer: { name: cust, phone, addr, req: memo },
      storeId,
      agreePrivacy: true,
      returnTo: location.pathname + location.search
    };

    setPendingOrder(pendingPayload);

    try {
      await startPayment({ orderId, amount: total, orderName });
    } catch (err) {
      console.error('payment start error', err);
      alert('ê²°ì œë¥¼ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
    }
  };
</script>
</body>
</html>
