<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link rel="stylesheet" href="/src/admin/assets/css/style.css"/>
  <title>ë°°ë‹¬/ì˜ˆì•½ (ë¹„íšŒì›)</title>

  <style>
    /* ğŸ”¹ ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ ë²„íŠ¼ ìŠ¤íƒ€ì¼: ê¸°ì¡´ë³´ë‹¤ ì•½ 30% ì‘ê²Œ */
    #privacy-open {
      font-size: 0.85rem;      /* 30% ì‘ê²Œ */
      padding: 4px 8px;        /* ë²„íŠ¼ ë†’ì´ ì¶•ì†Œ */
      background: #1e293b;
      border-radius: 6px;
      white-space: nowrap;
    }

    /* ğŸ”¹ ì²´í¬ë°•ìŠ¤ + ë³´ê¸° ë²„íŠ¼ì„ ê°™ì€ ì¤„ì— ì •ë ¬ */
    .privacy-row-flex {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      width: 100%;
    }

    /* ğŸ”¹ ê°œì¸ì •ë³´ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
    #privacy-modal {
      display:none; position:fixed; inset:0;
      background:rgba(0,0,0,0.55); z-index:9998;
      align-items:center; justify-content:center;
    }
    #privacy-modal-inner {
      background:#020617; padding:16px 18px;
      border-radius:12px; max-width:520px;
      width:calc(100% - 40px); max-height:80vh;
      overflow:auto;
    }
  </style>
</head>

<body data-store-id="">
<div class="container">

  <!-- ìƒë‹¨ -->
  <div class="hstack" style="justify-content:space-between">
    <h1>ë°°ë‹¬/ì˜ˆì•½ (ë¹„íšŒì›)</h1>
    <div class="hstack" style="gap:8px">
      <a id="btn-mypage" class="btn" href="#">ë§ˆì´í˜ì´ì§€</a>
      <a id="btn-select" class="btn" href="#">ì£¼ë¬¸ ìœ í˜•</a>
    </div>
  </div>

  <!-- ë°°ë‹¬ / ì˜ˆì•½ ì„ íƒ -->
  <div class="card hstack" style="gap:8px">
    <label><input type="radio" name="tab" id="tab-deliv" checked> ë°°ë‹¬(ê²°ì œ)</label>
    <label><input type="radio" name="tab" id="tab-resv"> ì˜ˆì•½(ë¬´ê²°ì œ)</label>
  </div>

  <!-- ì •ë³´ ì…ë ¥ -->
  <div class="card vstack" id="form-box">
    <h3>ë°°ë‹¬/ì˜ˆì•½ ì •ë³´ <span class="small">*</span></h3>

    <div class="vstack" style="gap:10px">

      <!-- ë°°ì†¡ì§€ -->
      <div class="field-row">
        <div class="field-label addr-label">ë°°ì†¡ì§€</div>
        <div class="addr-wrap">
          <input id="addr" class="input" />
          <input id="addr-detail" class="input addr-detail" placeholder="ìƒì„¸ì£¼ì†Œ" />
        </div>
      </div>

      <!-- ì£¼ë¬¸ìëª… -->
      <div class="field-row">
        <div class="field-label">ì£¼ë¬¸ìëª…</div>
        <input id="cust" class="input" />
      </div>

      <!-- ì—°ë½ì²˜ -->
      <div class="field-row">
        <div class="field-label">ì—°ë½ì²˜</div>
        <input id="phone" class="input" placeholder="ìˆ«ìë§Œ ê¸°ì…" inputmode="numeric" />
      </div>

      <!-- ì˜ˆì•½ ì¼ì -->
      <div class="field-row" id="date-row">
        <div class="field-label">ì¼ì</div>
        <div class="date-time-row">
          <input id="date" type="date" class="input date-input">
          <span class="time-label">ì˜ˆì•½ì‹œê°„</span>
          <select id="time-ap" class="input input-sm time-ap"></select>
          <select id="time-hh" class="input input-sm"></select>
          <select id="time-mm" class="input input-sm"></select>
        </div>
      </div>

      <!-- ìš”ì²­ì‚¬í•­ -->
      <div class="field-row">
        <div class="field-label">ìš”ì²­ì‚¬í•­</div>
        <textarea id="memo" class="input" rows="4"></textarea>
      </div>

      <!-- ğŸ”¹ ê°œì¸ì •ë³´ ë™ì˜ + ë³´ê¸° ë²„íŠ¼ (ë ˆì´ì•„ì›ƒ ì™„ì „ ê°œì„ ë¨) -->
      <div class="field-row small" id="privacy-row">
        <div class="field-label">ê°œì¸ì •ë³´</div>

        <div class="privacy-row-flex">
          <label style="cursor:pointer; display:flex; align-items:center; gap:6px;">
            <input type="checkbox" id="agree-privacy">
            <span>(í•„ìˆ˜) ìˆ˜ì§‘Â·ì´ìš© ë™ì˜</span>
          </label>

          <!-- ğŸ”¹ 30% ì‘ì•„ì§„ ë²„íŠ¼ -->
          <button type="button" class="btn" id="privacy-open">
            ë³´ê¸°
          </button>
        </div>
      </div>

      <!-- ê³„ì¢Œ ì•ˆë‚´ -->
      <div id="bank-box" class="field-row small" style="display:none">
        <div class="field-label">ì…ê¸ˆê³„ì¢Œ</div>
        <div class="hstack" style="gap:6px;flex-wrap:wrap">
          <span id="bank-text"></span>
          <button class="btn" id="bank-copy" type="button">ë³µì‚¬</button>
        </div>
        <div class="small" style="margin-top:4px; color:#f97316;">
          â€» ì£¼ë¬¸ìëª…ìœ¼ë¡œ ì…ê¸ˆí•´ì£¼ì„¸ìš”!
        </div>
      </div>

    </div>
  </div>

  <!-- ë©”ë‰´ -->
  <div class="card vstack">
    <h3>ë©”ë‰´</h3>
    <div id="menu-grid" class="hstack" style="gap:12px;flex-wrap:wrap"></div>
  </div>

  <!-- ì¥ë°”êµ¬ë‹ˆ -->
  <div class="card vstack">
    <h3>ì¥ë°”êµ¬ë‹ˆ</h3>
    <div id="cart-box" class="vstack"></div>
  </div>

  <!-- ê²°ì œ -->
  <div class="card hstack" style="justify-content:space-between">
    <div>í•©ê³„: <b id="total">0</b>ì›</div>
    <button id="action-btn" class="btn primary">ê²°ì œí•˜ê¸°</button>
  </div>
</div>

<!-- ğŸ”¹ ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ ëª¨ë‹¬ -->
<div id="privacy-modal">
  <div id="privacy-modal-inner">
    <h3 style="margin:0 0 8px 0;">ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨</h3>
    <div id="privacy-modal-body" class="small" style="white-space:pre-wrap;"></div>
    <div class="hstack" style="justify-content:flex-end;margin-top:12px">
      <button type="button" id="privacy-close" class="btn">ë‹«ê¸°</button>
    </div>
  </div>
</div>

<!-- ğŸ”¥ ì „ì²´ ìŠ¤í¬ë¦½íŠ¸ -->
<script type="module">
  import { renderMenu, makeCart } from '/src/order/assets/js/modules/menu-cart.js';
  import { get } from '/src/order/assets/js/modules/cust-store.js';
  import { fillTimeSelectors } from '/src/order/assets/js/modules/time.js';
  import { setPendingOrder, startPayment } from '/src/shared/toss-client.js';
  import { ensureStoreInitialized } from '/src/shared/store.js';

  /* â­ storeId ì´ˆê¸°í™” */
  const storeId = ensureStoreInitialized();
  window.qrnrStoreId = storeId;
  document.body.setAttribute('data-store-id', storeId);

  /* URL ë³´ì • */
  const url = new URL(location.href);
  if (!url.searchParams.get('store')) {
    url.searchParams.set('store', storeId);
    location.replace(url);
  }

  document.getElementById("btn-mypage").href = `/src/order/mypage.html?store=${storeId}`;
  document.getElementById("btn-select").href = `/src/order/select.html?store=${storeId}`;

  fillTimeSelectors('time');
  const cart = makeCart('cart-box', 'total');
  cart.render();
  renderMenu('menu-grid', cart);

  /* ==========================================================
     ğŸ”¥ ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ ë³´ê¸° ê¸°ëŠ¥ (API + ëª¨ë‹¬)
  ========================================================== */
  const privacyOpen = document.getElementById("privacy-open");
  const privacyClose = document.getElementById("privacy-close");
  const modal = document.getElementById("privacy-modal");
  const modalBody = document.getElementById("privacy-modal-body");

  if (privacyOpen) {
    privacyOpen.onclick = async () => {
      try {
        const r = await fetch("/api/policy");
        const j = await r.json();

        modalBody.textContent = j?.policy?.text || "(ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.)";
        modal.style.display = "flex";
      } catch (e) {
        alert("ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
      }
    };
  }

  if (privacyClose) {
    privacyClose.onclick = () => {
      modal.style.display = "none";
    };
  }
</script>

</body>
</html>
